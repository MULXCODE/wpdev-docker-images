ARG PACKAGE_REGISTRY
ARG PR_TAG
FROM $PACKAGE_REGISTRY/php:5.2-fpm$PR_TAG

##########################################################################
#
# WARNING: This file was generated by update.php.
#
# You can find the relevant template in the `/templates` folder.
#

RUN apt-get update && apt-get install -y git --no-install-recommends && rm -rf /var/lib/apt/lists/*
    && mkdir ~/phpunit
    && cd ~/phpunit
    && git clone git://github.com/sebastianbergmann/phpunit.git \
    && git clone git://github.com/sebastianbergmann/dbunit.git \
    && git clone git://github.com/sebastianbergmann/php-file-iterator.git \
    && git clone git://github.com/sebastianbergmann/php-text-template.git \
    && git clone git://github.com/sebastianbergmann/php-code-coverage.git \
    && git clone git://github.com/sebastianbergmann/php-token-stream.git \
    && git clone git://github.com/sebastianbergmann/php-timer.git \
    && git clone git://github.com/sebastianbergmann/phpunit-mock-objects.git \
    && git clone git://github.com/sebastianbergmann/phpunit-selenium.git \
    && git clone git://github.com/sebastianbergmann/phpunit-story.git \
    && git clone git://github.com/sebastianbergmann/php-invoker.git \
    && cd ~/phpunit/phpunit && git checkout 3.6.12 \
    && cd ~/phpunit/dbunit && git checkout 1.1.2 \
    && cd ~/phpunit/php-file-iterator && git checkout 1.3.4 \
    && cd ~/phpunit/php-timer && git checkout 1.0.3 \
    && cd ~/phpunit/php-text-template && git checkout 1.1.2 \
    && cd ~/phpunit/php-token-stream && git checkout 1.1.4 \
    && cd ~/phpunit/php-code-coverage && git checkout 1.1.3 \
    && cd ~/phpunit/phpunit-mock-objects && git checkout 1.1.1 \
    && cd ~/phpunit/phpunit-selenium && git checkout 1.2.8 \
    && chmod +x ~/phpunit/phpunit/phpunit.php \
    && ln -s ~/phpunit/phpunit/phpunit.php /usr/bin/phpunit \
    && apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false -o APT::AutoRemove::SuggestsImportant=false git \
    && apt-get autoremove

WORKDIR /var/www

COPY entrypoint.sh /entrypoint.sh

RUN chmod +x /entrypoint.sh

ENTRYPOINT [ "/entrypoint.sh" ]

CMD /usr/local/bin/phpunit
